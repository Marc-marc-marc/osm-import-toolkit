Open Street Map Importing and Mechanical Edit Toolkit
==================

Please read and follow the OSM import guidelines here, here, and here!

- http://wiki.openstreetmap.org/wiki/Import/Guidelines
- http://wiki.openstreetmap.org/wiki/Mechanical_Edit_Policy
- http://wiki.openstreetmap.org/wiki/Automated_Edits_code_of_conduct

There is a lot of software spread here and there for doing mechanical edits and imports of Open Street Map data. The goal of this repository is to collect and document the best scripts written by myself and others for doing imports and mechanical edits.

Community feedback and QA'ing activities will often require reprocessing the data from scratch. Automation is often required to support quick and reproducible reprocessing when the inevitable tweak is needed. The tools in this repository are scripts that can be fully automated. Whenever possible processing should be automated, rather than using graphical tools like QGIS or JOSM.

Uploading
------------------

 - upload/osm2osc.py - Many of the utilities that convert external data to OSM write out an .osm file. However, only .osc files can be uploaded. This simple utility converts an .osm to .osc. This is basically unmodified from the version in OSM SVN.

 - upload/osmsplit.py - Breaks an .osc file into several smaller .osc files. The OSM API has a 50,000 element limit for a single change set. In practice, the change sets should be kept much smaller, around 10,000 elements. Therefor, before uploading large .osc files, they need to be broken up. The smaller .osc files generated by this script are self contained without cross dependencies. The lack of dependencies means files can be uploaded in any order and errors in the uploads can be easily handled.

 - upload/osmupload.py - Uploads a set of .osc files into a server that supports the OSM API. This is a heavily modified version of the upload.py script that is hosted on the OSM SVN server. It keeps a log of the uploads, supports testing uploads to the development server, does not use "chunks", so that each .osc file upload is atomic, allows comment and source tags on the change set to be pulled from files, will not double upload a file, and will try hard to always close out a change set if an error occurs. The log holds the change set ids, so it is possible to review an already completed upload.

OSM Preparation
------------------

Sometimes errors in the existing OSM data needs to be fixed before the actual conflation/merging logic of the import will work correctly. These scripts run QA checks for some common OSM errors that could impact imports. They all 
require a osm2pgsql PostGIS database, ogr2ogr, and ogr2osm.

 - prep/findaerowwaywithnobuildings.py - Find all aeroway=terminal areas that don't also have building=* tag. Building import conflation/merging logic that is only using building=* tag, will fail on airport terminals that are just tagged with aeroway=terminal. Use this script to fix the terminals before the import.

 - prep/findschoolswithnobuildings.py - Find all amenity=school areas without a building=* tag. Not necessarily an error, but could indicate that a school building was tagged with amenity=school without the building tag. Building import conflation/merging logic that is only using for building=* tag will fail on schools buildings that are just tagged with amenity=school. Use this script is used to inspect, and fix any incorrectly tagged schools before the import.

 - prep/findoverlappingbuildings.py - Find all overlapping buildings. After an import containing buildings, run this script to insure that data was not uploaded twice. It is suggested to run it before a building/address import to baseline the OSM data in the area. 

Environment
-----------------

This toolkit requires many other tools. Many are included standard in Debian Linux and are trivial to install. If Windows is your primary operating system, it is recommended to install Debian Linux into a virtual machine, like Oracle's busybox http://www.busybox.net/, and run the tools inside of the virtual machine. 

 - OSM Data - Imports and mechanical edits will almost always need to include processing of the existing OSM data to perform merging/conflation. The recommended source for regional OSM extracts is http://download.geofabrik.de/. To support automated reprocessing, the wget utility in a shell script should be used for downloading extracts for your import.

 - PostGIS - http://postgis.org/ - PostGIS is an extension to PostgreSQL that adds support for common GIS operations via SQL. When the import or mechanical edit needs to make decisions based on existing OSM data the processing is done in SQL rather than processing the .osm/.xml file directly. If possible, use the default database name of gis.

 - osm2pgsql - There are many possible OSM to PostGIS schema's http://wiki.openstreetmap.org/wiki/Database_schema#Database_Schemas. For now, only the osm2pgsql schema/loader is used by this toolkit, use osm2pgsql to import OSM extracts into PostGIS.

 - ogr2ogr - http://www.gdal.org/ - Is part of the gdal project. It it used to re-project source data and to extract data back out from a PostGIS database. Currently gdal does not support the .osm file well. This toolkit will use ogr2osm with .shp (shape) files, then use ogr2osm to convert from a .shp file to .osm file.

 - ogr2osm - https://github.com/pnorman/ogr2osm - This utility converts .shp to .osm files. It is currently not packaged as part of Debian. It will need to be installed manually. You have the option of installing it anywhere and adding to your path, or installing it in ./ogr2osm. Where ./ is the root of this repository. The tools will first check if it is ./ogr2osm, then try the path. To "install" it into ./org2osm run the following git command.

    git clone https://github.com/pnorman/ogr2osm.git









